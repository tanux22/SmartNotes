name: CI/CD Pipeline for Render with Docker

on:
  push:
    branches:
      - "**" # Run on all branches

jobs:
  docker:
      name: ğŸ³ Build and Push Docker Images for Frontend & Backend
      runs-on: ubuntu-latest
      steps:
        - name: ğŸ“¥ Checkout Code
          uses: actions/checkout@v3

        # Build and push backend image
        - name: ğŸ” Docker Login for Backend
          uses: docker/login-action@v2
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}

        - name: ğŸ§° Build Docker Image for Backend
          run: |
            cd backend
            docker build -t ${{ secrets.DOCKER_USERNAME }}/hackfolio-backend:${{ github.sha }} .

        - name: ğŸš€ Push Docker Image for Backend
          run: |
            docker push ${{ secrets.DOCKER_USERNAME }}/hackfolio-backend:${{ github.sha }}

        # Build and push frontend image
        - name: ğŸ” Docker Login for Frontend
          uses: docker/login-action@v2
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}

        - name: ğŸ§° Build Docker Image for Frontend
          run: |
            cd frontend
            docker build -t ${{ secrets.DOCKER_USERNAME }}/hackfolio-frontend:${{ github.sha }} .

        - name: ğŸš€ Push Docker Image for Frontend
          run: |
            docker push ${{ secrets.DOCKER_USERNAME }}/hackfolio-frontend:${{ github.sha }}
